<!DOCTYPE html><html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Flutter 工作原理  - Flutter 中文文档 - Flutter 社区中文资源 </title>
  <link rel="shortcut icon" href="/images/favicon.png">

  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-ND4LWWZ');</script>
  <!-- End Google Tag Manager -->

  
  <meta name="description" content="This document describes the inner workings of the Flutter toolkit that makeFlutter’s API possible. Because Flutter widgets are built using aggressivecomposition, user interfaces built with Flutter have a large number ofwidgets. To support this workload, Flutter uses sublinear algorithms forlayout and building widgets as well as data structures that make...">
  <meta name="keywords" content=" ">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@flutterdev">

  <meta property="og:title" content="Flutter 工作原理">
  <meta property="og:url" content="https://flutter.dev/docs/resources/inside-flutter">
  <meta property="og:description" content="This document describes the inner workings of the Flutter toolkit that makeFlutter’s API possible. Because Flutter widgets are built using aggressivecomposition, user interfaces built with Flutter have a large number ofwidgets. To support this workload, Flutter uses sublinear algorithms forlayout and building widgets as well as data structures that make...">
  
  <meta property="og:image" content="https://flutter.dev/images/flutter-logo-sharing.png">

  <link href="/assets/translator/css/material-roboto.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/assets/main-74a0c308218334fcd85291a957a514973015ea8e4eb76b9abae6e14bb5012f5e.css">
  
  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
  <script src="/assets/main-d6b8b8d26e7b4122b3ddf6a5201966d6e2494aaffadaafaf7c571ce5e2fe0aab.js" type="text/javascript"></script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-122680122-1', 'auto');
    ga('send', 'pageview');
  </script>

  <!--<meta name="google-site-verification" content="HFqxhSbf9YA_0rBglNLzDiWnrHiK_w4cqDh2YD2GEY4" />-->
<link href="/assets/translator/css/translator.css" rel="stylesheet"></head>
<body>
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-ND4LWWZ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<div id="overlay-under-drawer"></div>

    <header class="site-header">
  <nav class="navbar navbar-expand-md justify-content-start justify-content-md-between">
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <i class="material-icons">menu</i>
    </button>

    <a class="navbar-brand" href="/">
      <img alt="Flutter by Google" height="37" width="129" class="align-middle" src="/assets/flutter-lockup-4cb0ee072ab312e59784d9fbf4fb7ad42688a7fdaea1270ccf6bbf4f34b7e03f.svg">
    </a>

    <div class="collapse navbar-collapse flex-grow-0" id="navbarSupportedContent">
      <div class="site-header__sheet-bg" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"></div>
      <div class="site-header__sheet">
        <ul class="navbar-nav">

          <li class="nav-item">
            <a class="nav-link active" href="/docs">开发文档</a>
          </li>
          <div class="site-sidebar site-sidebar--header d-md-none">
            <ul class="nav flex-column"><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-1" role="button" aria-expanded="false" aria-controls="sidenav-1">开始使用 Flutter</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-1">
        <li class="nav-item">
    <a class="nav-link" href="/docs/get-started/install">1. 安装和环境配置</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/get-started/editor">2. 编辑工具设定</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/get-started/test-drive">3. 开发体验初探</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/get-started/codelab">4. 编写第一个 Flutter 应用</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/get-started/learn-more">5. 了解更多</a>
  </li><div class="dropdown-divider"></div><li class="nav-item">
    <a class="nav-link collapsable" data-toggle="collapse" data-target="#sidenav-1-7" href="#sidenav-1-7" role="button" aria-expanded="true" aria-controls="sidenav-1-7">拥有其他平台开发经验？
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-1-7">
      <li class="nav-item">
    <a class="nav-link" href="/docs/get-started/flutter-for/android-devs">给 Android 开发者的 Flutter 指南</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/get-started/flutter-for/ios-devs">给 iOS 开发者的 Flutter 指南</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/get-started/flutter-for/react-native-devs">给 React Native 开发者的 Flutter 指南</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/get-started/flutter-for/web-devs">给 Web 开发者的 Flutter 指南</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/get-started/flutter-for/xamarin-forms-devs">给 Xamarin.Forms 开发者的 Flutter 指南</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="https://www.dartlang.org/guides/language" target="_blank" rel="noopener">Dart 语言概览<i class="fas fa-external-link-alt"></i></a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-2" role="button" aria-expanded="false" aria-controls="sidenav-2">教程和样例代码</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2">
        <li class="nav-item">
    <a class="nav-link" href="https://github.com/flutter/samples/blob/master/INDEX.md" target="_blank" rel="noopener">GitHub 上样例应用<i class="fas fa-external-link-alt"></i></a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/cookbook">实用教程 (Cookbook)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/codelabs">Codelabs</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/reference/tutorials">实践教程</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link " data-toggle="collapse" href="#sidenav-3" role="button" aria-expanded="true" aria-controls="sidenav-3">开发文档</a>

      <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-3">
        <li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-1" href="/docs/development/ui" role="button" aria-expanded="false" aria-controls="sidenav-3-1">用户界面
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-1">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/widgets-intro">Widgets 介绍</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-1-2" href="#sidenav-3-1-2" role="button" aria-expanded="false" aria-controls="sidenav-3-1-2">布局构建
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-1-2">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/layout">Flutter 中的布局</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/layout/tutorial">布局构建教程</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/layout/box-constraints">边界约束 (Box constraints)</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/interactive">交互添加</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/assets-and-images">资源和图片</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/navigation">路由和导航</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-1-6" href="/docs/development/ui/animations" role="button" aria-expanded="false" aria-controls="sidenav-3-1-6">动画效果
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-1-6">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/animations">介绍</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/animations/overview">概览</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/animations/tutorial">教程</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/animations/hero-animations">主动画 (Hero animations)</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/animations/staggered-animations">交织动画 (Staggered animations)</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-1-7" href="/docs/development/ui/advanced" role="button" aria-expanded="false" aria-controls="sidenav-3-1-7">用户界面 (UI) 进阶
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-1-7">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/advanced/slivers">滑动效果 (Slivers)</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/advanced/gestures">手势</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/widgets">核心 Widget 目录</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-2" href="/docs/development/data-and-backend" role="button" aria-expanded="false" aria-controls="sidenav-3-2">数据调用和后端
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-2">
      <li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-2-1" href="/docs/development/data-and-backend/state-mgmt" role="button" aria-expanded="false" aria-controls="sidenav-3-2-1">状态 (State) 管理
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-2-1">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/data-and-backend/state-mgmt/intro">状态管理介绍</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/data-and-backend/state-mgmt/declarative">声明式的编程思维</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/data-and-backend/state-mgmt/ephemeral-vs-app">短时 (ephemeral) 和共享 (app) 状态</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/data-and-backend/state-mgmt/simple">简单的共享 (app) 状态管理</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/data-and-backend/state-mgmt/options">状态管理参考</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/docs/development/data-and-backend/json">JSON 和序列化数据</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/development/data-and-backend/firebase">使用 Firebase</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-3" href="/docs/development/accessibility-and-localization" role="button" aria-expanded="false" aria-controls="sidenav-3-3">应用的无障碍和国际化
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-3">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/accessibility-and-localization/accessibility">无障碍</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/development/accessibility-and-localization/internationalization">国际化</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-4" href="/docs/development/platform-integration" role="button" aria-expanded="false" aria-controls="sidenav-3-4">平台集成
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-4">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/platform-integration/platform-channels">撰写双端平台代码 (插件编写实现)</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-5" href="/docs/development/packages-and-plugins" role="button" aria-expanded="false" aria-controls="sidenav-3-5">Packages (纯 Dart 和原生插件)
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-5">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/packages-and-plugins/using-packages">使用 Packages</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/development/packages-and-plugins/developing-packages">Package 的开发和提交</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/development/packages-and-plugins/background-processes">后台进程</a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://pub.flutter-io.cn/flutter" target="_blank" rel="noopener">Package 网站<i class="fas fa-external-link-alt"></i></a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-6" href="/docs/development/tools" role="button" aria-expanded="false" aria-controls="sidenav-3-6">开发工具和技术细节
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-6">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/tools/android-studio">Android Studio 或类 IntelliJ 系列</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/development/tools/vs-code">Visual Studio Code</a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://flutter.github.io/devtools/" target="_blank" rel="noopener">Dart 调试工具<i class="fas fa-external-link-alt"></i></a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-6-4" href="/docs/development/tools/sdk" role="button" aria-expanded="false" aria-controls="sidenav-3-6-4">Flutter SDK
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-6-4">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/tools/sdk/upgrading">版本升级</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/tools/sdk/releases">版本列表</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/docs/development/tools/hot-reload">热重载 (Hot reload)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/development/tools/formatting">代码格式</a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://flutter.github.io/devtools/inspector" target="_blank" rel="noopener">Flutter Inspector<i class="fas fa-external-link-alt"></i></a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-4" role="button" aria-expanded="false" aria-controls="sidenav-4">测试和调优</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-4">
        <li class="nav-item">
    <a class="nav-link" href="/docs/testing/debugging">调试 Flutter 应用</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/testing/oem-debuggers">使用原生的调试器</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/testing/build-modes">构建模式 (Debug/Release/Profile)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/testing">测试 Flutter 应用</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/testing/best-practices">性能优化最佳实践</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/testing/ui-performance">Flutter 性能分析</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-5" role="button" aria-expanded="false" aria-controls="sidenav-5">打包部署</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-5">
        <li class="nav-item">
    <a class="nav-link" href="/docs/deployment/flavors">配置 flavors 构建双端</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/deployment/android">打包和发布到 Android 平台</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/deployment/ios">打包和发布到 iOS 平台</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/deployment/fastlane-cd">使用 fastlane 持续交付</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link active" data-toggle="collapse" href="#sidenav-6" role="button" aria-expanded="true" aria-controls="sidenav-6">资源列表</a>

      <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-6">
        <li class="nav-item">
    <a class="nav-link" href="/docs/resources/bootstrap-into-dart">Dart 资源列表</a>
  </li><li class="nav-item">
    <a class="nav-link active" href="/docs/resources/inside-flutter">Flutter 工作原理</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/resources/platform-adaptations">平台行为差异和适配</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/resources/technical-overview">技术概览</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/resources/videos">Flutter 技术视频资源</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/resources/faq">常见问题解答</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link " data-toggle="collapse" href="#sidenav-7" role="button" aria-expanded="true" aria-controls="sidenav-7">参考资料</a>

      <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-7">
        <li class="nav-item">
    <a class="nav-link" href="/docs/reference/widgets">Flutter Widget 目录</a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://docs.flutter.cn" target="_blank" rel="noopener">Flutter API 文档<i class="fas fa-external-link-alt"></i></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://pub.flutter-io.cn/flutter" target="_blank" rel="noopener">Package 网站<i class="fas fa-external-link-alt"></i></a>
  </li>
</ul>
    </li></ul>

          </div>

<!-- 
          <li class="nav-item">
            <a class="nav-link" href="/showcase">Showcase</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/community">Community</a>
          </li>
 -->
        </ul>
        <form action="/search" class="site-header__search form-inline">
          <input class="site-header__searchfield form-control" type="search" name="q" id="q" autocomplete="off" placeholder="Search" aria-label="Search">
        </form>
      </div>
    </div>
    <div class="site-header__social navbar-nav flex-row">
      <a class="nav-item nav-link" href="https://twitter.com/flutterdev"><i class="fab fa-twitter fa-lg"></i></a>
      <a class="nav-item nav-link" href="https://www.youtube.com/flutterdev"><i class="fab fa-youtube fa-lg"></i></a>
      <a class="nav-item nav-link" href="https://github.com/flutter"><i class="fab fa-github fa-lg"></i></a>
    </div>
    <a class="site-header__cta btn btn-primary" href="/docs/get-started/install/">Get started</a>
    </nav>
</header>
<div class="site-banner site-banner--default" role="alert">
    <p>
      We are looking for a Flutter Infrastructure engineer!
      <a href="/jobs/infrastructure" target="_blank" rel="noopener">Learn more</a>.
    </p>

  </div>
<div class="container-fluid position-relative">
  <div class="row flex-xl-nowrap">
    <div class="fixed-col site-sidebar site-sidebar--fixed col-12 col-md-3 col-xl-2 d-none d-md-block" data-fixed-column="">
      <ul class="nav flex-column"><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-1" role="button" aria-expanded="false" aria-controls="sidenav-1">开始使用 Flutter</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-1">
        <li class="nav-item">
    <a class="nav-link" href="/docs/get-started/install">1. 安装和环境配置</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/get-started/editor">2. 编辑工具设定</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/get-started/test-drive">3. 开发体验初探</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/get-started/codelab">4. 编写第一个 Flutter 应用</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/get-started/learn-more">5. 了解更多</a>
  </li><div class="dropdown-divider"></div><li class="nav-item">
    <a class="nav-link collapsable" data-toggle="collapse" data-target="#sidenav-1-7" href="#sidenav-1-7" role="button" aria-expanded="true" aria-controls="sidenav-1-7">拥有其他平台开发经验？
    </a>
    <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-1-7">
      <li class="nav-item">
    <a class="nav-link" href="/docs/get-started/flutter-for/android-devs">给 Android 开发者的 Flutter 指南</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/get-started/flutter-for/ios-devs">给 iOS 开发者的 Flutter 指南</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/get-started/flutter-for/react-native-devs">给 React Native 开发者的 Flutter 指南</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/get-started/flutter-for/web-devs">给 Web 开发者的 Flutter 指南</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/get-started/flutter-for/xamarin-forms-devs">给 Xamarin.Forms 开发者的 Flutter 指南</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="https://www.dartlang.org/guides/language" target="_blank" rel="noopener">Dart 语言概览<i class="fas fa-external-link-alt"></i></a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-2" role="button" aria-expanded="false" aria-controls="sidenav-2">教程和样例代码</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-2">
        <li class="nav-item">
    <a class="nav-link" href="https://github.com/flutter/samples/blob/master/INDEX.md" target="_blank" rel="noopener">GitHub 上样例应用<i class="fas fa-external-link-alt"></i></a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/cookbook">实用教程 (Cookbook)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/codelabs">Codelabs</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/reference/tutorials">实践教程</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link " data-toggle="collapse" href="#sidenav-3" role="button" aria-expanded="true" aria-controls="sidenav-3">开发文档</a>

      <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-3">
        <li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-1" href="/docs/development/ui" role="button" aria-expanded="false" aria-controls="sidenav-3-1">用户界面
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-1">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/widgets-intro">Widgets 介绍</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-1-2" href="#sidenav-3-1-2" role="button" aria-expanded="false" aria-controls="sidenav-3-1-2">布局构建
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-1-2">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/layout">Flutter 中的布局</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/layout/tutorial">布局构建教程</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/layout/box-constraints">边界约束 (Box constraints)</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/interactive">交互添加</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/assets-and-images">资源和图片</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/navigation">路由和导航</a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-1-6" href="/docs/development/ui/animations" role="button" aria-expanded="false" aria-controls="sidenav-3-1-6">动画效果
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-1-6">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/animations">介绍</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/animations/overview">概览</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/animations/tutorial">教程</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/animations/hero-animations">主动画 (Hero animations)</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/animations/staggered-animations">交织动画 (Staggered animations)</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-1-7" href="/docs/development/ui/advanced" role="button" aria-expanded="false" aria-controls="sidenav-3-1-7">用户界面 (UI) 进阶
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-1-7">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/advanced/slivers">滑动效果 (Slivers)</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/advanced/gestures">手势</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/docs/development/ui/widgets">核心 Widget 目录</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-2" href="/docs/development/data-and-backend" role="button" aria-expanded="false" aria-controls="sidenav-3-2">数据调用和后端
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-2">
      <li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-2-1" href="/docs/development/data-and-backend/state-mgmt" role="button" aria-expanded="false" aria-controls="sidenav-3-2-1">状态 (State) 管理
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-2-1">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/data-and-backend/state-mgmt/intro">状态管理介绍</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/data-and-backend/state-mgmt/declarative">声明式的编程思维</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/data-and-backend/state-mgmt/ephemeral-vs-app">短时 (ephemeral) 和共享 (app) 状态</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/data-and-backend/state-mgmt/simple">简单的共享 (app) 状态管理</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/data-and-backend/state-mgmt/options">状态管理参考</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/docs/development/data-and-backend/json">JSON 和序列化数据</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/development/data-and-backend/firebase">使用 Firebase</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-3" href="/docs/development/accessibility-and-localization" role="button" aria-expanded="false" aria-controls="sidenav-3-3">应用的无障碍和国际化
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-3">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/accessibility-and-localization/accessibility">无障碍</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/development/accessibility-and-localization/internationalization">国际化</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-4" href="/docs/development/platform-integration" role="button" aria-expanded="false" aria-controls="sidenav-3-4">平台集成
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-4">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/platform-integration/platform-channels">撰写双端平台代码 (插件编写实现)</a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-5" href="/docs/development/packages-and-plugins" role="button" aria-expanded="false" aria-controls="sidenav-3-5">Packages (纯 Dart 和原生插件)
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-5">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/packages-and-plugins/using-packages">使用 Packages</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/development/packages-and-plugins/developing-packages">Package 的开发和提交</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/development/packages-and-plugins/background-processes">后台进程</a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://pub.flutter-io.cn/flutter" target="_blank" rel="noopener">Package 网站<i class="fas fa-external-link-alt"></i></a>
  </li></ul>
  </li>
<li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-6" href="/docs/development/tools" role="button" aria-expanded="false" aria-controls="sidenav-3-6">开发工具和技术细节
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-6">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/tools/android-studio">Android Studio 或类 IntelliJ 系列</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/development/tools/vs-code">Visual Studio Code</a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://flutter.github.io/devtools/" target="_blank" rel="noopener">Dart 调试工具<i class="fas fa-external-link-alt"></i></a>
  </li><li class="nav-item">
    <a class="nav-link collapsable collapsed" data-toggle="collapse" data-target="#sidenav-3-6-4" href="/docs/development/tools/sdk" role="button" aria-expanded="false" aria-controls="sidenav-3-6-4">Flutter SDK
    </a>
    <ul class="nav flex-column flex-nowrap collapse " id="sidenav-3-6-4">
      <li class="nav-item">
    <a class="nav-link" href="/docs/development/tools/sdk/upgrading">版本升级</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="/docs/development/tools/sdk/releases">版本列表</a>
  </li>
  </ul>
  </li>
<li class="nav-item">
    <a class="nav-link" href="/docs/development/tools/hot-reload">热重载 (Hot reload)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/development/tools/formatting">代码格式</a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://flutter.github.io/devtools/inspector" target="_blank" rel="noopener">Flutter Inspector<i class="fas fa-external-link-alt"></i></a>
  </li></ul>
  </li>

</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-4" role="button" aria-expanded="false" aria-controls="sidenav-4">测试和调优</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-4">
        <li class="nav-item">
    <a class="nav-link" href="/docs/testing/debugging">调试 Flutter 应用</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/testing/oem-debuggers">使用原生的调试器</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/testing/build-modes">构建模式 (Debug/Release/Profile)</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/testing">测试 Flutter 应用</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/testing/best-practices">性能优化最佳实践</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/testing/ui-performance">Flutter 性能分析</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link collapsed" data-toggle="collapse" href="#sidenav-5" role="button" aria-expanded="false" aria-controls="sidenav-5">打包部署</a>

      <ul class="nav flex-column flex-nowrap collapse " id="sidenav-5">
        <li class="nav-item">
    <a class="nav-link" href="/docs/deployment/flavors">配置 flavors 构建双端</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/deployment/android">打包和发布到 Android 平台</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/deployment/ios">打包和发布到 iOS 平台</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/deployment/fastlane-cd">使用 fastlane 持续交付</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link active" data-toggle="collapse" href="#sidenav-6" role="button" aria-expanded="true" aria-controls="sidenav-6">资源列表</a>

      <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-6">
        <li class="nav-item">
    <a class="nav-link" href="/docs/resources/bootstrap-into-dart">Dart 资源列表</a>
  </li><li class="nav-item">
    <a class="nav-link active" href="/docs/resources/inside-flutter">Flutter 工作原理</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/resources/platform-adaptations">平台行为差异和适配</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/resources/technical-overview">技术概览</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/resources/videos">Flutter 技术视频资源</a>
  </li><li class="nav-item">
    <a class="nav-link" href="/docs/resources/faq">常见问题解答</a>
  </li>
</ul>
    </li><li class="nav-item">
      <a class="nav-link " data-toggle="collapse" href="#sidenav-7" role="button" aria-expanded="true" aria-controls="sidenav-7">参考资料</a>

      <ul class="nav flex-column flex-nowrap collapse show" id="sidenav-7">
        <li class="nav-item">
    <a class="nav-link" href="/docs/reference/widgets">Flutter Widget 目录</a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://docs.flutter.cn" target="_blank" rel="noopener">Flutter API 文档<i class="fas fa-external-link-alt"></i></a>
  </li><li class="nav-item">
    <a class="nav-link" href="https://pub.flutter-io.cn/flutter" target="_blank" rel="noopener">Package 网站<i class="fas fa-external-link-alt"></i></a>
  </li>
</ul>
    </li></ul>

    </div>
    <div id="site-toc--side" class="site-toc site-toc--side fixed-col col-xl-2 order-3" data-fixed-column="">
  <header class="site-toc__title">
    Contents
    <button type="button" class="btn site-toc--button__page-top" aria-label="Page top"></button>
    </header>
  <ul class="section-nav nav">
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#aggressive-composability">Aggressive composability</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#sublinear-layout">Sublinear layout</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#sublinear-widget-building">Sublinear widget building</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#linear-reconciliation">Linear reconciliation</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#tree-surgery">Tree surgery</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#constant-factor-optimizations">Constant-factor optimizations</a></li>
</ul>
</li>
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#infinite-scrolling">Infinite scrolling</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#viewport-aware-layout">Viewport-aware layout</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#building-widgets-on-demand">Building widgets on demand</a></li>
</ul>
</li>
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#api-ergonomics">API Ergonomics</a>
<ul class="nav">
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#specializing-apis-to-match-the-developers-mindset">Specializing APIs to match the developer’s mindset</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#explicit-arguments">Explicit arguments</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#paving-over-pitfalls">Paving over pitfalls</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#reporting-error-cases-aggressively">Reporting error cases aggressively</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#reactive-paradigm">Reactive paradigm</a></li>
<li class="toc-entry nav-item toc-h3"><a class="nav-link" href="#interpolation">Interpolation</a></li>
</ul>
</li>
<li class="toc-entry nav-item toc-h2"><a class="nav-link" href="#conclusion">Conclusion</a></li>
</ul>
</div>
<main class="site-content col-12 col-md-9 offset-md-3 col-xl-8 offset-xl-2 col-xxl-8 offset-xxl-2" role="main">
      <div class="container">
        
        
        <header class="site-content__title">
          <div id="page-github-links" class="btn-group" aria-label="Page GitHub links" role="group">
  <a href="https://github.com/cfug/flutter.cn/tree/master/src/docs/resources/inside-flutter.md" class="btn no-automatic-external" title="View page source" target="_blank" rel="noopener">
    <i class="fas fa-file-alt fa-sm"></i>
  </a>
  <a href="https://github.com/cfug/flutter.cn/issues/new?title='Flutter 工作原理' page issue&amp;body=
Page URL: https://flutter.dev/docs/resources/inside-flutter.html%0D%0A
Page source: https://github.com/cfug/flutter.cn/tree/master/src/docs/resources/inside-flutter.md%0D%0A
%0D%0A
Found a typo? You can fix it yourself by going to the page source and clicking the pencil icon. Or finish creating this issue.%0D%0A
%0D%0A
Description of issue:" class="btn no-automatic-external" title="Report an issue with this page" target="_blank" rel="noopener">
    <i class="fas fa-bug fa-sm"></i>
  </a>
</div>

          <h1 id="flutter-工作原理">Flutter 工作原理</h1>
          </header>
        <div id="site-toc--inline" class="site-toc site-toc--inline ">
  <header class="site-toc__title">
    Contents
    </header>
  <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#aggressive-composability">Aggressive composability</a>
<ul>
<li class="toc-entry toc-h3"><a href="#sublinear-layout">Sublinear layout</a></li>
<li class="toc-entry toc-h3"><a href="#sublinear-widget-building">Sublinear widget building</a></li>
<li class="toc-entry toc-h3"><a href="#linear-reconciliation">Linear reconciliation</a></li>
<li class="toc-entry toc-h3"><a href="#tree-surgery">Tree surgery</a></li>
<li class="toc-entry toc-h3"><a href="#constant-factor-optimizations">Constant-factor optimizations</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#infinite-scrolling">Infinite scrolling</a>
<ul>
<li class="toc-entry toc-h3"><a href="#viewport-aware-layout">Viewport-aware layout</a></li>
<li class="toc-entry toc-h3"><a href="#building-widgets-on-demand">Building widgets on demand</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#api-ergonomics">API Ergonomics</a>
<ul>
<li class="toc-entry toc-h3"><a href="#specializing-apis-to-match-the-developers-mindset">Specializing APIs to match the developer’s mindset</a></li>
<li class="toc-entry toc-h3"><a href="#explicit-arguments">Explicit arguments</a></li>
<li class="toc-entry toc-h3"><a href="#paving-over-pitfalls">Paving over pitfalls</a></li>
<li class="toc-entry toc-h3"><a href="#reporting-error-cases-aggressively">Reporting error cases aggressively</a></li>
<li class="toc-entry toc-h3"><a href="#reactive-paradigm">Reactive paradigm</a></li>
<li class="toc-entry toc-h3"><a href="#interpolation">Interpolation</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#conclusion">Conclusion</a></li>
</ul>
</div>
<p>This document describes the inner workings of the Flutter toolkit that make
Flutter’s API possible. Because Flutter widgets are built using aggressive
composition, user interfaces built with Flutter have a large number of
widgets.  To support this workload, Flutter uses sublinear algorithms for
layout and building widgets as well as data structures that make tree
surgery efficient and that have a number of constant-factor optimizations.
With some additional details, this design also makes it easy for developers
to create infinite scrolling lists using callbacks that build exactly those
widgets that are visible to the user.</p>

<h2 id="aggressive-composability">
<a id="aggressive-composability" class="anchor" href="#aggressive-composability" aria-hidden="true"><span class="octicon octicon-link"></span></a>Aggressive composability</h2>

<p>One of the most distinctive aspects of Flutter is its <em>aggressive
composability</em>. Widgets are built by composing other widgets,
which are themselves built out of progressively more basic widgets.
For example, <code class="highlighter-rouge">Padding</code> is a widget rather than a property of other widgets.
As a result, user interfaces built with Flutter consist of many,
many widgets.</p>

<p>The widget building recursion bottoms out in <code class="highlighter-rouge">RenderObjectWidgets</code>,
which are widgets that create nodes in the underlying <em>render</em> tree.
The render tree is a data structure that stores the geometry of the user
interface, which is computed during <em>layout</em> and used during <em>painting</em> and
<em>hit testing</em>. Most Flutter developers do not author render objects directly
but instead manipulate the render tree using widgets.</p>

<p>In order to support aggressive composability at the widget layer,
Flutter uses a number of efficient algorithms and optimizations at
both the widget and render tree layers, which are described in the
following subsections.</p>

<h3 id="sublinear-layout">
<a id="sublinear-layout" class="anchor" href="#sublinear-layout" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sublinear layout</h3>

<p>With a large number of widgets and render objects, the key to good
performance is efficient algorithms. Of paramount importance is the
performance of <em>layout</em>, which is the algorithm that determines the
geometry (for example, the size and position) of the render objects.
Some other toolkits use layout algorithms that are O(N²) or worse
(for example, fixed-point iteration in some constraint domain).
Flutter aims for linear performance for initial layout, and <em>sublinear
layout performance</em> in the common case of subsequently updating an
existing layout. Typically, the amount of time spent in layout should
scale more slowly than the number of render objects.</p>

<p>Flutter performs one layout per frame, and the layout algorithm works
in a single pass. <em>Constraints</em> are passed down the tree by parent
objects calling the layout method on each of their children.
The children recursively perform their own layout and then return
<em>geometry</em> up the tree by returning from their layout method. Importantly,
once a render object has returned from its layout method, that render
object will not be visited again<sup><a href="#a1">1</a></sup>
until the layout for the next frame. This approach combines what might
otherwise be separate measure and layout passes into a single pass and,
as a result, each render object is visited <em>at most
twice</em><sup><a href="#a2">2</a></sup> during layout: once on the way
down the tree, and once on the way up the tree.</p>

<p>Flutter has several specializations of this general protocol.
The most common specialization is <code class="highlighter-rouge">RenderBox</code>, which operates in
two-dimensional, cartesian coordinates. In box layout, the constraints
are a min and max width and a min and max height. During layout,
the child determines its geometry by choosing a size within these bounds.
After the child returns from layout, the parent decides the child’s
position in the parent’s coordinate system<sup><a href="#a3">3</a></sup>.
Notice that the child’s layout cannot depend on the child’s position
because the child’s position is not determined until after the child
returns from layout. As a result, the parent is free to reposition
the child without needing to recompute the child’s layout.</p>

<p>More generally, during layout, the <em>only</em> information that flows from
parent to child are the constraints and the <em>only</em> information that
flows from child to parent is the geometry. These invariants can reduce
the amount of work required during layout:</p>

<ul>
  <li>
    <p>If the child has not marked its own layout as dirty, the child can
return immediately from layout, cutting off the walk, as long as the
parent gives the child the same constraints as the child received
during the previous layout.</p>
  </li>
  <li>
    <p>Whenever a parent calls a child’s layout method, the parent indicates
whether it uses the size information returned from the child. If,
as often happens, the parent does not use the size information,
then the parent need not recompute its layout if the child selects
a new size because the parent is guaranteed that the new size will
conform to the existing constraints.</p>
  </li>
  <li>
    <p><em>Tight</em> constraints are those that can be satisfied by exactly one
valid geometry. For example, if the min and max widths are equal to
each other and the min and max heights are equal to each other,
the only size that satisfies those constraints is one with that
width and height. If the parent provides tight constraints,
then the parent need not recompute its layout whenever the child
recomputes its layout, even if the parent uses the child’s size
in its layout, because the child cannot change size without new
constraints from its parent.</p>
  </li>
  <li>
    <p>A render object can declare that it uses the constraints provided
by the parent only to determine its geometry. Such a declaration
informs the framework that the parent of that render object does
not need to recompute its layout when the child recomputes its layout
<em>even if the constraints are not tight</em> and <em>even if the parent’s
layout depends on the child’s size</em>, because the child cannot change
size without new constraints from its parent.</p>
  </li>
</ul>

<p>As a result of these optimizations, when the render object tree contains
dirty nodes, only those nodes and a limited part of the subtree around
them are visited during layout.</p>

<h3 id="sublinear-widget-building">
<a id="sublinear-widget-building" class="anchor" href="#sublinear-widget-building" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sublinear widget building</h3>

<p>Similar to the layout algorithm, Flutter’s widget building algorithm
is sublinear. After being built, the widgets are held by the <em>element
tree</em>, which retains the logical structure of the user interface.
The element tree is necessary because the widgets themselves are
<em>immutable</em>, which means (among other things), they cannot remember their
parent or child relationships with other widgets. The element tree also
holds the <em>state</em> objects associated with stateful widgets.</p>

<p>In response to user input (or other stimuli), an element can become dirty,
for example if the developer calls <code class="highlighter-rouge">setState()</code> on the associated state
object. The framework keeps a list of dirty elements and jumps directly
to them during the <em>build</em> phase, skipping over clean elements. During
the build phase, information flows <em>unidirectionally</em> down the element
tree, which means each element is visited at most once during the build
phase.  Once cleaned, an element cannot become dirty again because,
by induction, all its ancestor elements are also
clean<sup><a href="#a4">4</a></sup>.</p>

<p>Because widgets are <em>immutable</em>, if an element has not marked itself as
dirty, the element can return immediately from build, cutting off the walk,
if the parent rebuilds the element with an identical widget. Moreover,
the element need only compare the object identity of the two widget
references in order to establish that the new widget is the same as
the old widget. Developers exploit this optimization to implement the
<em>reprojection</em> pattern, in which a widget includes a prebuilt child
widget stored as a member variable in its build.</p>

<p>During build, Flutter also avoids walking the parent chain using
<code class="highlighter-rouge">InheritedWidgets</code>. If widgets commonly walked their parent chain,
for example to determine the current theme color, the build phase
would become O(N²) in the depth of the tree, which can be quite
large due to aggressive composition. To avoid these parent walks,
the framework pushes information down the element tree by maintaining
a hash table of <code class="highlighter-rouge">InheritedWidget</code>s at each element. Typically, many
elements will reference the same hash table, which changes only at
elements that introduce a new <code class="highlighter-rouge">InheritedWidget</code>.</p>

<h3 id="linear-reconciliation">
<a id="linear-reconciliation" class="anchor" href="#linear-reconciliation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Linear reconciliation</h3>

<p>Contrary to popular belief, Flutter does not employ a tree-diffing
algorithm. Instead, the framework decides whether to reuse elements by
examining the child list for each element independently using an O(N)
algorithm. The child list reconciliation algorithm optimizes for the
following cases:</p>

<ul>
  <li>The old child list is empty.</li>
  <li>The two lists are identical.</li>
  <li>There is an insertion or removal of one or more widgets in exactly
one place in the list.</li>
  <li>If each list contains a widget with the same key, the two widgets are
matched.</li>
</ul>

<p>The general approach is to match up the beginning and end of both child
lists by comparing the runtime type and key of each widget,
potentially finding a non-empty range in the middle of each list
that contains all the unmatched children. The framework then places
the children in the range in the old child list into a hash table
based on their keys. Next, the framework walks the range in the new
child list and queries the hash table by key for matches. Unmatched
children are discarded and rebuilt from scratch whereas matched children
are rebuilt with their new widgets.</p>

<h3 id="tree-surgery">
<a id="tree-surgery" class="anchor" href="#tree-surgery" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tree surgery</h3>

<p>Reusing elements is important for performance because elements own
two critical pieces of data: the state for stateful widgets and the
underlying render objects. When the framework is able to reuse an element,
the state for that logical part of the user interface is preserved
and the layout information computed previously can be reused,
often avoiding entire subtree walks. In fact, reusing elements is
so valuable that Flutter supports <em>non-local</em> tree mutations that
preserve state and layout information.</p>

<p>Developers can perform a non-local tree mutation by associating a <code class="highlighter-rouge">GlobalKey</code>
with one of their widgets. Each global key is unique throughout the
entire application and is registered with a thread-specific hash table.
During the build phase, the developer can move a widget with a global
key to an arbitrary location in the element tree. Rather than building
a fresh element at that location, the framework will check the hash
table and reparent the existing element from its previous location to
its new location, preserving the entire subtree.</p>

<p>The render objects in the reparented subtree are able to preserve
their layout information because the layout constraints are the only
information that flows from parent to child in the render tree.
The new parent is marked dirty for layout because its child list has
changed, but if the new parent passes the child the same layout
constraints the child received from its old parent, the child can
return immediately from layout, cutting off the walk.</p>

<p>Global keys and non-local tree mutations are used extensively by
developers to achieve effects such as hero transitions and navigation.</p>

<h3 id="constant-factor-optimizations">
<a id="constant-factor-optimizations" class="anchor" href="#constant-factor-optimizations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Constant-factor optimizations</h3>

<p>In addition to these algorithmic optimizations, achieving aggressive
composability also relies on several important constant-factor
optimizations. These optimizations are most important at the leaves of
the major algorithms discussed above.</p>

<ul>
  <li>
    <p><strong>Child-model agnostic.</strong> Unlike most toolkits, which use child lists,
Flutter’s render tree does not commit to a specific child model.
For example, the <code class="highlighter-rouge">RenderBox</code> class has an abstract <code class="highlighter-rouge">visitChildren()</code>
method rather than a concrete <em>firstChild</em> and <em>nextSibling</em> interface.
Many subclasses support only a single child, held directly as a member
variable, rather than a list of children. For example, <code class="highlighter-rouge">RenderPadding</code>
supports only a single child and, as a result, has a simpler layout
method that takes less time to execute.</p>
  </li>
  <li>
    <p><strong>Visual render tree, logical widget tree.</strong> In Flutter, the render
tree operates in a device-independent, visual coordinate system,
which means smaller values in the x coordinate are always towards
the left, even if the current reading direction is right-to-left.
The widget tree typically operates in logical coordinates, meaning
with <em>start</em> and <em>end</em> values whose visual interpretation depends
on the reading direction. The transformation from logical to visual
coordinates is done in the handoff between the widget tree and the
render tree. This approach is more efficient because layout and
painting calculations in the render tree happen more often than the
widget-to-render tree handoff and can avoid repeated coordinate conversions.</p>
  </li>
  <li>
    <p><strong>Text handled by a specialized render object.</strong> The vast majority
of render objects are ignorant of the complexities of text. Instead,
text is handled by a specialized render object, <code class="highlighter-rouge">RenderParagraph</code>,
which is a leaf in the render tree. Rather than subclassing a
text-aware render object, developers incorporate text into their
user interface using composition. This pattern means <code class="highlighter-rouge">RenderParagraph</code>
can avoid recomputing its text layout as long as its parent supplies
the same layout constraints, which is common, even during tree surgery.</p>
  </li>
  <li>
    <p><strong>Observable objects.</strong> Flutter uses both the model-observation and
the reactive paradigms. Obviously, the reactive paradigm is dominant,
but Flutter uses observable model objects for some leaf data structures.
For example, <em>Animations</em> notify an observer list when their value changes.
Flutter hands off these observable objects from the widget tree to the
render tree, which observes them directly and invalidates only the
appropriate stage of the pipeline when they change. For example,
a change to an _Animation<color>_ might trigger only the paint phase
rather than both the build and paint phases.</color></p>
  </li>
</ul>

<p>Taken together and summed over the large trees created by aggressive
composition, these optimizations have a substantial effect on performance.</p>

<h2 id="infinite-scrolling">
<a id="infinite-scrolling" class="anchor" href="#infinite-scrolling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Infinite scrolling</h2>

<p>Infinite scrolling lists are notoriously difficult for toolkits.
Flutter supports infinite scrolling lists with a simple interface
based on the <em>builder</em> pattern, in which a <code class="highlighter-rouge">ListView</code> uses a callback
to build widgets on demand as they become visible to the user during
scrolling. Supporting this feature requires <em>viewport-aware layout</em>
and <em>building widgets on demand</em>.</p>

<h3 id="viewport-aware-layout">
<a id="viewport-aware-layout" class="anchor" href="#viewport-aware-layout" aria-hidden="true"><span class="octicon octicon-link"></span></a>Viewport-aware layout</h3>

<p>Like most things in Flutter, scrollable widgets are built using
composition. The outside of a scrollable widget is a <code class="highlighter-rouge">Viewport</code>,
which is a box that is “bigger on the inside,” meaning its children
can extend beyond the bounds of the viewport and can be scrolled into
view. However, rather than having <code class="highlighter-rouge">RenderBox</code> children, a viewport has
<code class="highlighter-rouge">RenderSliver</code> children, known as <em>slivers</em>, which have a viewport-aware
layout protocol.</p>

<p>The sliver layout protocol matches the structure of the box layout
protocol in that parents pass constraints down to their children and
receive geometry in return. However, the constraint and geometry data
differs between the two protocols. In the sliver protocol, children
are given information about the viewport, including the amount of
visible space remaining. The geometry data they return enables a
variety of scroll-linked effects, including collapsible headers and
parallax.</p>

<p>Different slivers fill the space available in the viewport in different
ways. For example, a sliver that produces a linear list of children lays
out  each child in order until the sliver either runs out of children or
runs out of space. Similarly, a sliver that produces a two-dimensional
grid of children fills only the portion of its grid that is visible.
Because they are aware of how much space is visible, slivers can produce
a finite number of children even if they have the potential to produce
an unbounded number of children.</p>

<p>Slivers can be composed to create bespoke scrollable layouts and effects.
For example, a single viewport can have a collapsible header followed
by a linear list and then a grid. All three slivers will cooperate through
the sliver layout protocol to produce only those children that are actually
visible through the viewport, regardless of whether those children belong
to the header, the list, or the grid.</p>

<h3 id="building-widgets-on-demand">
<a id="building-widgets-on-demand" class="anchor" href="#building-widgets-on-demand" aria-hidden="true"><span class="octicon octicon-link"></span></a>Building widgets on demand</h3>

<p>If Flutter had a strict <em>build-then-layout-then-paint</em> pipeline,
the foregoing would be insufficient to implement an infinite scrolling
list because the information about how much space is visible through
the viewport is available only during the layout phase. Without
additional machinery, the layout phase is too late to build the
widgets necessary to fill the space. Flutter solves this problem
by interleaving the build and layout phases of the pipeline. At any
point in the layout phase, the framework can start building new
widgets on demand <em>as long as those widgets are descendants of the
render object currently performing layout</em>.</p>

<p>Interleaving build and layout is possible only because of the strict
controls on information propagation in the build and layout algorithms.
Specifically, during the build phase, information can propagate only
down the tree. When a render object is performing layout, the layout
walk has not visited the subtree below that render object, which means
writes generated by building in that subtree cannot invalidate any
information that has entered the layout calculation thus far. Similarly,
once layout has returned from a render object, that render object will
never be visited again during this layout, which means any writes
generated by subsequent layout calculations cannot invalidate the
information used to build the render object’s subtree.</p>

<p>Additionally, linear reconciliation and tree surgery are essential
for efficiently updating elements during scrolling and for modifying
the render tree when elements are scrolled into and out of view at
the edge of the viewport.</p>

<h2 id="api-ergonomics">
<a id="api-ergonomics" class="anchor" href="#api-ergonomics" aria-hidden="true"><span class="octicon octicon-link"></span></a>API Ergonomics</h2>

<p>Being fast only matters if the framework can actually be used effectively.
To guide Flutter’s API design towards greater usability, Flutter has been
repeatedly tested in extensive UX studies with developers. These studies
sometimes confirmed pre-existing design decisions, sometimes helped guide
the prioritization of features, and sometimes changed the direction of the
API design. For instance, Flutter’s APIs are heavily documented; UX
studies confirmed the value of such documentation, but also highlighted
the need specifically for sample code and illustrative diagrams.</p>

<p>This section discusses some of the decisions made in Flutter’s API design
in aid of usability.</p>

<h3 id="specializing-apis-to-match-the-developers-mindset">
<a id="specializing-apis-to-match-the-developers-mindset" class="anchor" href="#specializing-apis-to-match-the-developers-mindset" aria-hidden="true"><span class="octicon octicon-link"></span></a>Specializing APIs to match the developer’s mindset</h3>

<p>The base class for nodes in Flutter’s <code class="highlighter-rouge">Widget</code>, <code class="highlighter-rouge">Element</code>, and <code class="highlighter-rouge">RenderObject</code>
trees does not define a child model. This allows each node to be
specialized for the child model that is applicable to that node.</p>

<p>Most <code class="highlighter-rouge">Widget</code> objects have a single child <code class="highlighter-rouge">Widget</code>, and therefore only expose
a single <code class="highlighter-rouge">child</code> parameter. Some widgets support an arbitrary number of
children, and expose a <code class="highlighter-rouge">children</code> parameter that takes a list.
Some widgets don’t have any children at all and reserve no memory,
and have no parameters for them. Similarly, <code class="highlighter-rouge">RenderObjects</code> expose APIs
specific to their child model. <code class="highlighter-rouge">RenderImage</code> is a leaf node, and has no
concept of children. <code class="highlighter-rouge">RenderPadding</code> takes a single child, so it has storage
for a single pointer to a single child. <code class="highlighter-rouge">RenderFlex</code> takes an arbitrary
number of children and manages it as a linked list.</p>

<p>In some rare cases, more complicated child models are used. The
<code class="highlighter-rouge">RenderTable</code> render object’s constructor takes an array of arrays of
children, the class exposes getters and setters that control the number
of rows and columns, and there are specific methods to replace
individual children by x,y coordinate, to add a row, to provide a
new array of arrays of children, and to replace the entire child list
with a single array and a column count. In the implementation,
the object does not use a linked list like most render objects but
instead uses an indexable array.</p>

<p>The <code class="highlighter-rouge">Chip</code> widgets and <code class="highlighter-rouge">InputDecoration</code> objects have fields that match
the slots that exist on the relevant controls. Where a one-size-fits-all
child model would force semantics to be layered on top of a list of
children, for example, defining the first child to be the prefix value
and the second to be the suffix, the dedicated child model allows for
dedicated named properties to be used instead.</p>

<p>This flexibility allows each node in these trees to be manipulated in
the way most idiomatic for its role. It’s rare to want to insert a cell
in a table, causing all the other cells to wrap around; similarly,
it’s rare to want to remove a child from a flex row by index instead
of by reference.</p>

<p>The <code class="highlighter-rouge">RenderParagraph</code> object is the most extreme case: it has a child of
an entirely different type, <code class="highlighter-rouge">TextSpan</code>. At the <code class="highlighter-rouge">RenderParagraph</code> boundary,
the <code class="highlighter-rouge">RenderObject</code> tree transitions into being a <code class="highlighter-rouge">TextSpan</code> tree.</p>

<p>The overall approach of specializing APIs to meet the developer’s
expectations is applied to more than just child models.</p>

<p>Some rather trivial widgets exist specifically so that developers
will find them when looking for a solution to a problem. Adding a
space to a row or column is easily done once one knows how, using
the <code class="highlighter-rouge">Expanded</code> widget and a zero-sized <code class="highlighter-rouge">SizedBox</code> child, but discovering
that pattern is unnecessary because searching for <code class="highlighter-rouge">space</code>
uncovers the <code class="highlighter-rouge">Spacer</code> widget, which uses <code class="highlighter-rouge">Expanded</code> and <code class="highlighter-rouge">SizedBox</code> directly
to achieve the effect.</p>

<p>Similarly, hiding a widget subtree is easily done by not including the
widget subtree in the build at all. However, developers typically expect
there to be a widget to do this, and so the <code class="highlighter-rouge">Visibility</code> widget exists
to wrap this pattern in a trivial reusable widget.</p>

<h3 id="explicit-arguments">
<a id="explicit-arguments" class="anchor" href="#explicit-arguments" aria-hidden="true"><span class="octicon octicon-link"></span></a>Explicit arguments</h3>

<p>UI frameworks tend to have many properties, such that a developer is
rarely able to remember the semantic meaning of each constructor
argument of each class. As Flutter uses the reactive paradigm,
it is common for build methods in Flutter to have many calls to
constructors. By leveraging Dart’s support for named arguments,
Flutter’s API is able to keep such build methods clear and understandable.</p>

<p>This pattern is extended to any method with multiple arguments,
and in particular is extended to any boolean argument, so that isolated
<code class="highlighter-rouge">true</code> or <code class="highlighter-rouge">false</code> literals in method calls are always self-documenting.
Furthermore, to avoid confusion commonly caused by double negatives
in APIs, boolean arguments and properties are always named in the
positive form (for example, <code class="highlighter-rouge">enabled: true</code> rather than <code class="highlighter-rouge">disabled: false</code>).</p>

<h3 id="paving-over-pitfalls">
<a id="paving-over-pitfalls" class="anchor" href="#paving-over-pitfalls" aria-hidden="true"><span class="octicon octicon-link"></span></a>Paving over pitfalls</h3>

<p>A technique used in a number of places in the Flutter framework is to
define the API such that error conditions don’t exist. This removes
entire classes of errors from consideration.</p>

<p>For example, interpolation functions allow one or both ends of the
interpolation to be null, instead of defining that as an error case:
interpolating between two null values is always null, and interpolating
from a null value or to a null value is the equivalent of interpolating
to the zero analog for the given type. This means that developers
who accidentally pass null to an interpolation function will not hit
an error case, but will instead get a reasonable result.</p>

<p>A more subtle example is in the <code class="highlighter-rouge">Flex</code> layout algorithm. The concept of
this layout is that the space given to the flex render object is
divided among its children, so the size of the flex should be the
entirety of the available space. In the original design, providing
infinite space would fail: it would imply that the flex should be
infinitely sized, a useless layout configuration. Instead, the API
was adjusted so that when infinite space is allocated to the flex
render object, the render object sizes itself to fit the desired
size of the children, reducing the possible number of error cases.</p>

<p>The approach is also used to avoid having constructors that allow
inconsistent data to be created. For instance, the <code class="highlighter-rouge">PointerDownEvent</code>
constructor does not allow the <code class="highlighter-rouge">down</code> property of <code class="highlighter-rouge">PointerEvent</code> to
be set to <code class="highlighter-rouge">false</code> (a situation that would be self-contradictory);
instead, the constructor does not have a parameter for the <code class="highlighter-rouge">down</code>
field and always sets it to <code class="highlighter-rouge">true</code>.</p>

<p>In general, the approach is to define valid interpretations for all
values in the input domain. The simplest example is the <code class="highlighter-rouge">Color</code> constructor.
Instead of taking four integers, one for red, one for green,
one for blue, and one for alpha, each of which could be out of range,
the default constructor takes a single integer value, and defines
the meaning of each bit (for example, the bottom eight bits define the
red component), so that any input value is a valid color value.</p>

<p>A more elaborate example is the <code class="highlighter-rouge">paintImage()</code> function. This function
takes eleven arguments, some with quite wide input domains, but they
have been carefully designed to be mostly orthogonal to each other,
such that there are very few invalid combinations.</p>

<h3 id="reporting-error-cases-aggressively">
<a id="reporting-error-cases-aggressively" class="anchor" href="#reporting-error-cases-aggressively" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reporting error cases aggressively</h3>

<p>Not all error conditions can be designed out. For those that remain,
in debug builds, Flutter generally attempts to catch the errors very
early and immediately reports them. Asserts are widely used.
Constructor arguments are sanity checked in detail. Lifecycles are
monitored and when inconsistencies are detected they immediately
cause an exception to be thrown.</p>

<p>In some cases, this is taken to extremes: for example, when running
unit tests, regardless of what else the test is doing, every <code class="highlighter-rouge">RenderBox</code>
subclass that is laid out aggressively inspects whether its intrinsic
sizing methods fulfill the intrinsic sizing contract. This helps catch
errors in APIs that might otherwise not be exercised.</p>

<p>When exceptions are thrown, they include as much information as
is available. Some of Flutter’s error messages proactively probe the
associated stack trace to determine the most likely location of the
actual bug. Others walk the relevant trees to determine the source
of bad data. The most common errors include detailed instructions
including in some cases sample code for avoiding the error, or links
to further documentation.</p>

<h3 id="reactive-paradigm">
<a id="reactive-paradigm" class="anchor" href="#reactive-paradigm" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reactive paradigm</h3>

<p>Mutable tree-based APIs suffer from a dichotomous access pattern:
creating the tree’s original state typically uses a very different
set of operations than subsequent updates. Flutter’s rendering layer
uses this paradigm, as it is an effective way to maintain a persistent tree,
which is key for efficient layout and painting. However, it means
that direct interaction with the rendering layer is awkward at best
and bug-prone at worst.</p>

<p>Flutter’s widget layer introduces a composition mechanism using the
reactive paradigm to manipulate the underlying rendering tree.
This API abstracts out the tree manipulation by combining the tree
creation and tree mutation steps into a single tree description (build)
step, where, after each change to the system state, the new configuration
of the user interface is described by the developer and the framework
computes the series of tree mutations necessary to reflect this new
configuration.</p>

<h3 id="interpolation">
<a id="interpolation" class="anchor" href="#interpolation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Interpolation</h3>

<p>Since Flutter’s framework encourages developers to describe the interface
configuration matching the current application state, a mechanism exists
to implicitly animate between these configurations.</p>

<p>For example, suppose that in state S<sub>1</sub> the interface consists
of a circle, but in state S<sub>2</sub> it consists of a square.
Without an animation mechanism, the state change would have a jarring
interface change. An implicit animation allows the circle to be smoothly
squared over several frames.</p>

<p>Each feature that can be implicitly animated has a stateful widget that
keeps a record of the current value of the input, and begins an animation
sequence whenever the input value changes, transitioning from the current
value to the new value over a specified duration.</p>

<p>This is implemented using <code class="highlighter-rouge">lerp</code> (linear interpolation) functions using
immutable objects. Each state (circle and square, in this case)
is represented as an immutable object that is configured with
appropriate settings (color, stroke width, etc) and knows how to paint
itself. When it is time to draw the intermediate steps during the animation,
the start and end values are passed to the appropriate <code class="highlighter-rouge">lerp</code> function
along with a <em>t</em> value representing the point along the animation,
where 0.0 represents the <code class="highlighter-rouge">start</code> and 1.0 represents the <code class="highlighter-rouge">end</code>,
and the function returns a third immutable object representing the
intermediate stage.</p>

<p>For the circle-to-square transition, the <code class="highlighter-rouge">lerp</code> function would return
an object representing a “rounded square” with a radius described as
a fraction derived from the <em>t</em> value, a color interpolated using the
<code class="highlighter-rouge">lerp</code> function for colors, and a stroke width interpolated using the
<code class="highlighter-rouge">lerp</code> function for doubles. That object, which implements the
same interface as circles and squares, would then be able to paint
itself when requested to.</p>

<p>This technique allows the state machinery, the mapping of states to
configurations, the animation machinery, the interpolation machinery,
and the specific logic relating to how to paint each frame to be
entirely separated from each other.</p>

<p>This approach is broadly applicable. In Flutter, basic types like
<code class="highlighter-rouge">Color</code> and <code class="highlighter-rouge">Shape</code> can be interpolated, but so can much more elaborate
types such as <code class="highlighter-rouge">Decoration</code>, <code class="highlighter-rouge">TextStyle</code>, or <code class="highlighter-rouge">Theme</code>. These are
typically constructed from components that can themselves be interpolated,
and interpolating the more complicated objects is often as simple as
recursively interpolating all the values that describe the complicated
objects.</p>

<p>Some interpolatable objects are defined by class hierarchies. For example,
shapes are represented by the <code class="highlighter-rouge">ShapeBorder</code> interface, and there exists a
variety of shapes, including <code class="highlighter-rouge">BeveledRectangleBorder</code>, <code class="highlighter-rouge">BoxBorder</code>,
<code class="highlighter-rouge">CircleBorder</code>, <code class="highlighter-rouge">RoundedRectangleBorder</code>, and <code class="highlighter-rouge">StadiumBorder</code>. A single
<code class="highlighter-rouge">lerp</code> function cannot have a priori knowledge of all the possible types,
and therefore the interface instead defines <code class="highlighter-rouge">lerpFrom</code> and <code class="highlighter-rouge">lerpTo</code> methods,
which the static <code class="highlighter-rouge">lerp</code> method defers to. When told to interpolate from
a shape A to a shape B, first B is asked if it can <code class="highlighter-rouge">lerpFrom</code> A, then,
if it cannot, A is instead asked if it can <code class="highlighter-rouge">lerpTo</code> B. (If neither is
possible, then the function returns A from values of <code class="highlighter-rouge">t</code> less than 0.5,
and returns B otherwise.)</p>

<p>This allows the class hierarchy to be arbitrarily extended, with later
additions being able to interpolate between previously-known values
and themselves.</p>

<p>In some cases, the interpolation itself cannot be described by any of
the available classes, and a private class is defined to describe the
intermediate stage. This is the case, for instance, when interpolating
between a <code class="highlighter-rouge">CircleBorder</code> and a <code class="highlighter-rouge">RoundedRectangleBorder</code>.</p>

<p>This mechanism has one further added advantage: it can handle interpolation
from intermediate stages to new values. For example, half-way through
a circle-to-square transition, the shape could be changed once more,
causing the animation to need to interpolate to a triangle. So long as
the triangle class can <code class="highlighter-rouge">lerpFrom</code> the rounded-square intermediate class,
the transition can be seamlessly performed.</p>

<h2 id="conclusion">
<a id="conclusion" class="anchor" href="#conclusion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conclusion</h2>

<p>Flutter’s slogan, “everything is a widget,” revolves around building
user interfaces by composing widgets that are, in turn, composed of
progressively more basic widgets. The result of this aggressive
composition is a large number of widgets that require carefully
designed algorithms and data structures to process efficiently.
With some additional design, these data structures also make it
easy for developers to create infinite scrolling lists that build
widgets on demand when they become visible.</p>

<hr>

<p><strong>Footnotes:</strong></p>

<p><sup><a name="a1">1</a></sup> For layout, at least. It may be revisited
  for painting, for building the accessibility tree if necessary,
  and for hit testing if necessary.</p>

<p><sup><a name="a2">2</a></sup> Reality, of course, is a bit more
  complicated. Some layouts involve intrinsic dimensions or baseline
  measurements, which do involve an additional walk of the relevant subtree
  (aggressive caching is used to mitigate the potential for quadratic
  performance in the worst case). These cases, however, are surprisingly
  rare. In particular, intrinsic dimensions are not required for the
  common case of shrink-wrapping.</p>

<p><sup><a name="a3">3</a></sup> Technically, the child’s position is not
  part of its RenderBox geometry and therefore need not actually be
  calculated during layout. Many render objects implicitly position
  their single child at 0,0 relative to their own origin, which
  requires no computation or storage at all. Some render objects
  avoid computing the position of their children until the last
  possible moment (for example, during the paint phase), to avoid
  the computation entirely if they are not subsequently painted.</p>

<p><sup><a name="a4">4</a></sup>  There exists one exception to this rule.
  As discussed in the <a href="#building-widgets-on-demand">Building widgets on demand</a>
  section, some widgets can be rebuilt as a result of a change in layout
  constraints. If a widget marked itself dirty for unrelated reasons in
  the same frame that it also is affected by a change in layout constraints,
  it will be updated twice. This redundant build is limited to the
  widget itself and does not impact its descendants.</p>

<p><sup><a name="a5">5</a></sup> A key is an opaque object optionally
  associated with a widget whose equality operator is used to influence
  the reconciliation algorithm.</p>

<p><sup><a name="a6">6</a></sup>  For accessibility, and to give applications
  a few extra milliseconds between when a widget is built and when it
  appears on the screen, the viewport creates (but does not paint)
  widgets for a few hundred pixels before and after the visible widgets.</p>

<p><sup><a name="a7">7</a></sup>  This approach was first made popular by
  Facebook’s React library.</p>

<p><sup><a name="a8">8</a></sup>  In practice, the <em>t</em> value is allowed
  to extend past the 0.0-1.0 range, and does so for some curves. For
  example, the “elastic” curves overshoot briefly in order to represent
  a bouncing effect. The interpolation logic typically can extrapolate
  past the start or end as appropriate. For some types, for example,
  when interpolating colors, the <em>t</em> value is effectively clamped to
  the 0.0-1.0 range.</p>

        
      </div>
    </main>
  </div>
</div>
<footer class="site-footer">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-12 site-footer__wrapper">
        <div class="site-footer__logo">
          <img src="/images/flutter-mono-81x100.png" alt="Flutter Logo" width="81" height="100">
        </div>
        <div class="site-footer__content">
          <ul class="site-footer__link-list">
              <li><a href="https://groups.google.com/forum/#!forum/flutter-dev">flutter-dev@</a></li>
              <li><a href="/tos">terms</a></li>
              <li><a href="/security">security</a></li>
              <li><a href="https://www.google.com/intl/en/policies/privacy">privacy</a></li>
              <li><a href="https://flutter-es.io/">español</a></li>
              <li><a href="https://flutter-io.cn" class="text-nowrap">社区中文资源</a></li>
          </ul>

          <p class="licenses" translation-origin="on">
            Except as otherwise noted,
            this work is licensed under a
            <a rel="license" href="https://creativecommons.org/licenses/by/4.0">Creative
            Commons Attribution 4.0 International License</a>,
            and code samples are licensed under the BSD License.
          </p>
          <p class="licenses" translation-result="off">
            除非特别说明，否则本站内容采用 <a rel="license" href="https://creativecommons.org/licenses/by/4.0">CC BY 4.0 授权协议</a>，所有范例代码都采用 BSD 授权协议。
          </p>
        </div>
      </div>
    </div>
  </div>
</footer>


    <!-- <script async="" defer="" src="//survey.g.doubleclick.net/async_survey?site=at3ul57xpub2vk3oxt2ytw365i"></script> -->
  

<script src="/assets/translator/js/translator.js"></script></body></html>